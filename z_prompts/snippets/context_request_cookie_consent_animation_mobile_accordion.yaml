# ───────────────────────────────────────────────────────────────
# CONTEXT & REQUEST: Cookie Consent Animations + Mobile & Accordion Fixes
# ───────────────────────────────────────────────────────────────

user_inputs:
  context:
    environment: https://a-nobel-en-zn.webflow.io
    current_state: >-
      Cookie consent banner animation inconsistently triggered (not on page load
      and not after hero animation). Banner visible on desktop but not on mobile.
      Previous version used CSS for animation; desired approach is to control all
      initial animation states via JavaScript with Motion.dev. Accordion
      interactions in the consent UI are broken (toggle not clickable, chevron
      direction incorrect on open, description not visible on open).
    technical_stack: [Webflow, JavaScript, Motion.dev]
    dependencies:
      - Hero animation sequencing/trigger
      - Welcome modal (animation + focus trap behavior)
      - Accordion component and chevron icon
      - Consent storage/state logic
    related_systems:
      - Welcome modal
      - Cookie Settings modal
      - Hero section
      - Site-wide consent handling
    constraints:
      - Control all animation initial states via Motion.dev (no CSS-based state)
      - Maintain parity across desktop and mobile (responsive correctness)
      - Preserve consent logic and state; do not regress acceptance/decline flows
      - Meet accessibility standards (focus trap, keyboard navigation, ARIA)

  request:
    objective: >-
      Fix and standardize cookie consent banner and settings behavior across devices
      using Motion.dev, match welcome_modal animations, and ensure accessible
      accordion interactions.
    type: bug
    scope:
      - Banner animation on page load and after hero animation completes
      - Ensure banner shows on mobile as well as desktop when consent required
      - Replace CSS-based animation states with JS-initialized states via Motion.dev
      - Accordion: toggle clickable, chevron rotates up on open, description visible on open
      - Cookie Settings modal: animate like welcome_modal and include a close focus trap
      - Accessibility: keyboard navigation and focus management across banner and modal
    requirements:
      functional:
        - Banner animates in on page load and post-hero animation.
        - Banner appears only when consent is required on both desktop and mobile.
        - Accordion opens/closes correctly; toggle is clickable; description content is revealed; chevron indicates state.
        - Cookie Settings modal animation matches welcome_modal; modal supports closing and traps focus while open.
      technical:
        - Manage all initial animation states and transitions via Motion.dev (remove reliance on CSS animation state).
        - Provide reliable triggers: listen for hero animation completion with a DOM-ready fallback to show the banner.
        - Ensure responsive styles and logic do not hide the banner on mobile breakpoints.
        - Implement robust focus trap, restore focus to trigger on close, and add appropriate ARIA attributes/states.
        - No console errors; code organized for maintainability with clear init/teardown.
      ux:
        - Animations are smooth and consistent with welcome_modal; no jarring transitions.
        - Keyboard-only flow is intuitive; ESC closes modal, focus order is logical.
        - Visual indicators (chevron) clearly reflect accordion state.
    success_criteria:
      - Banner reliably animates in on load and post-hero across Chrome/Safari/Firefox.
      - Banner visible and functional on mobile and desktop when consent is pending.
      - Accordion behavior correct; chevron orientation updates; description content visible.
      - Cookie Settings modal matches welcome_modal animation and includes a working focus trap.
      - Accessibility checks pass (keyboard navigation, focus management); no console errors.
    testing:
      - Manual E2E on homepage with simulated consent states (unset/accepted/declined).
      - Verify hero-animation-linked trigger and DOM-ready fallback behavior.
      - Responsive testing across common mobile viewports
      - Accessibility verification: keyboard-only navigation, VoiceOver, focus trap behavior.
      - Optional unit tests/smoke tests for Motion.dev initialization logic.
