# ───────────────────────────────────────────────────────────────
# FRAMEWORK
# ───────────────────────────────────────────────────────────────
role: Expert Developer utilising the Github SpecKit workflow for planning and specification
purpose: Spec-driven development planning with workflow compliance through step 4
action: Execute SpecKit workflow from specification through planning phase with validation

operating_mode:
  execution: automatic
  approvals: critical_only
  workflow: sequential
  workflow_compliance: MANDATORY
  tracking: progressive_task_checklists
  validation: checkpoint_verification

rules:
  ALWAYS:
    - follow_workflow_sequence
    - document_all_changes
    - validate_before_completion
    - use_devtools_for_staging_analysis
    - stop_after_planning_phase
  NEVER:
    - skip_workflow_steps
    - ignore_blockers
    - submit_without_validation
    - skip_browser_analysis
    - proceed_beyond_planning

# ───────────────────────────────────────────────────────────────
# USER INPUTS
# ───────────────────────────────────────────────────────────────
user_inputs:
  context: "[CONTEXT]"  # Background information about performance issues
  request: "[REQUEST]"  # Specific performance improvement request

# ───────────────────────────────────────────────────────────────
# WORKFLOW - PLANNING PHASE ONLY
# ───────────────────────────────────────────────────────────────
workflow:
  step_0_request_analysis:
    input_source: USER_INPUTS_SECTION_ABOVE
    context: "Use [CONTEXT] value from user_inputs"
    request: "Use [REQUEST] value from user_inputs"
    action: Analyze requirements from filled user inputs and establish clear understanding
    outputs:
      - requirement_summary
      - approach_overview
      - complexity_assessment
    validation: understanding_confirmed
    approval_gate:
      type: USER_APPROVAL_REQUIRED
      prompt: "Requirements analyzed. Proceed to pre-work review?"
      confirmation_needed: true

  step_1_pre_work_review:
    required_documents:
      - AGENTS.md
      - .specify/memory/constitution.md
      - knowledge/*.md
    verification: MUST REVIEW BEFORE PROCEEDING
    validation: principles_established

  step_2_specification:
    command: /specify [feature-description]
    outputs:
      - feature_branch: created
      - spec.md: acceptance_criteria
      - location: specs/[NNN-feature]/spec.md
    validation: spec_complete
    chrome_devtools:
      when: analyzing_existing_features
      approach: Navigate → Snapshot → Analyze → Document

  step_3_clarification:
    command: /clarify
    outputs:
      - resolved_ambiguities
      - clarified_requirements
      - updated_spec
    validation: requirements_clear
    chrome_devtools:
      when: staging_url_provided
      approach: Navigate → Inspect → Analyze → Clarify
      capture: current_behavior_screenshots
    approval_gate:
      type: USER_APPROVAL_REQUIRED
      prompt: "Requirements clarified. Proceed to planning?"
      confirmation_needed: true

  step_4_planning:
    command: /plan [context]
    outputs:
      - plan.md: technical_approach
      - dependencies: identified
      - upstream_docs: reviewed
    validation: approach_defined
    chrome_devtools:
      when: analyzing_current_implementation
      actions:
        - inspect_network_requests
        - analyze_dom_structure
        - review_console_errors
        - capture_performance_metrics
    ultrathink:
      type: COMPREHENSIVE_PLANNING
      approach: deep_analysis
      outputs:
        - detailed_technical_approach
        - implementation_strategy
        - risk_assessment
        - dependency_mapping
    final_output:
      summary_document:
        location: specs/[NNN-feature]/planning-summary.md
        required_sections:
          - feature_overview
          - technical_approach
          - dependencies_identified
          - risks_and_mitigation
          - recommended_next_steps
      completion_message:
        Planning phase complete. The workflow has been executed through step 4.
        Technical plan and approach have been documented.
        To proceed with implementation, use the full workflow_automated.yaml.

# ───────────────────────────────────────────────────────────────
# WORKFLOW TERMINATION
# ───────────────────────────────────────────────────────────────
termination:
  after_step: 4
  message: "Planning phase completed successfully. Workflow terminated after step 4 as requested."
  next_steps:
    - Review planning documentation
    - Approve technical approach
    - Use workflow_automated.yaml for full implementation
    - Or use workflow.yaml for manual implementation with gates